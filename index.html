<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Randstad Digital — Monthly Rate Card Calculator</title>
<style>
  :root{--brand:#00338d;--accent:#00a8e8;--warm:#ff8200;--bg:#f4f7fb}
  body{font-family:Inter, system-ui, -apple-system, Arial, sans-serif;background:var(--bg);color:#07203a;margin:0;padding:20px}
  header{display:flex;align-items:center;gap:16px;max-width:1200px;margin:0 auto 12px}
  .logo{width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,var(--brand),#0066bb);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
  h1{font-size:20px;margin:0}
  .card{max-width:1200px;margin:12px auto;padding:16px;border-radius:12px;background:white;box-shadow:0 6px 22px rgba(2,6,23,0.06)}
  .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:12px}
  button{background:var(--brand);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  button.secondary{background:transparent;border:1px solid rgba(2,6,23,0.06);color:var(--brand)}
  button.warn{background:#d9534f}
  .help{color:#6b7a86;font-size:13px}

  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{border:1px solid rgba(2,6,23,0.06);padding:10px;text-align:left}
  thead th{background:linear-gradient(90deg,var(--brand),#0066bb);color:white}
  tbody tr:nth-child(even){background:rgba(2,6,23,0.02)}
  td[contenteditable]{min-width:80px}
  td.numeric{font-variant-numeric:tabular-nums;text-align:right}

  .graphics{display:flex;gap:12px;align-items:center}
  .banner{flex:1;padding:12px;border-radius:10px;background:linear-gradient(90deg,rgba(0,51,141,0.06),rgba(0,168,232,0.03));display:flex;align-items:center;gap:12px}
  .banner svg{width:56px;height:56px}

  #msg{margin-top:10px;font-size:13px;color:#184a67}

  @media (max-width:920px){header{flex-direction:column;align-items:flex-start} .graphics{flex-direction:column;align-items:flex-start}}
</style>
</head>
<body>
<header>
  <div class="logo">RD</div>
  <div>
    <h1>Randstad Digital — Monthly Rate Card Calculator</h1>
    <div class="help">Fill role details, LCTC/HCTC and margin %. LRC/HRC and monthly values auto-calc. Use Copy to paste into Word/Outlook.</div>
  </div>
</header>

<main class="card" id="app">
  <div class="graphics">
    <div class="banner">
      <!-- decorative SVG chart -->
      <svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <rect x="6" y="10" width="12" height="60" rx="2" fill="#bfe9ff" />
        <rect x="22" y="30" width="12" height="40" rx="2" fill="#87dcff" />
        <rect x="38" y="18" width="12" height="52" rx="2" fill="#00a8e8" />
        <rect x="54" y="6" width="12" height="64" rx="2" fill="#00338d" />
      </svg>
      <div>
        <strong>Monthly Rate Card</strong>
        <div style="color:#586e7b">Contract resource billing — Lower/Upper CTC to Rate Card</div>
      </div>
    </div>
    <div style="margin-left:auto;text-align:right">
      <img src="https://www.randstaddigital.com/themes/custom/randstad/logo.svg" alt="Randstad" height="36" style="opacity:0.95"/>
      <div style="font-size:12px;color:#6b7a86">Theme: Randstad Digital</div>
    </div>
  </div>

  <div class="toolbar" role="toolbar" aria-label="controls">
    <button id="addBtn">Add Row</button>
    <button id="calcBtn">Calculate</button>
    <button id="clearBtn" class="warn">Clear</button>
    <button id="copyBtn" class="secondary">Copy Table (Role,Skills,Exp,Location,Monthly INR)</button>
    <div style="flex:1"></div>
    <div id="msg" aria-live="polite"></div>
  </div>

  <div style="overflow:auto">
    <table id="rateTable">
      <thead>
        <tr>
          <th>Role</th>
          <th>Skills</th>
          <th>Experience</th>
          <th>Location</th>
          <th style="width:110px">LCTC (₹)</th>
          <th style="width:110px">HCTC (₹)</th>
          <th style="width:90px">Margin %</th>
          <th style="width:120px">LRC (₹)</th>
          <th style="width:120px">HRC (₹)</th>
          <th style="width:180px">Monthly Rate Card (INR)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td contenteditable="true">Developer</td>
          <td contenteditable="true">Java, Spring</td>
          <td contenteditable="true">3</td>
          <td contenteditable="true">Pune</td>
          <td contenteditable="true" class="numeric">500000</td>
          <td contenteditable="true" class="numeric">800000</td>
          <td contenteditable="true" class="numeric">20</td>
          <td class="numeric"></td>
          <td class="numeric"></td>
          <td class="numeric"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <p style="margin-top:12px;color:#576f79;font-size:13px">Notes: You can edit any cell. Numbers accept commas (5,00,000) or plain digits. The Copy function will try rich HTML copy first and fall back to plain text if blocked.</p>
</main>

<script>
// Utilities
const nf = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 });
function parseNumber(text){
  if(!text) return 0;
  const cleaned = (''+text).replace(/,/g,'').replace(/[^\d.-]/g,'').trim();
  return parseFloat(cleaned) || 0;
}

function formatNumber(num){
  return nf.format(Math.round(num));
}

// Core functions
function calculateRates(){
  const rows = document.querySelectorAll('#rateTable tbody tr');
  rows.forEach(row => {
    const lctc = parseNumber(row.cells[4].innerText);
    const hctc = parseNumber(row.cells[5].innerText);
    const margin = parseNumber(row.cells[6].innerText);

    const lrc = lctc + (lctc * margin / 100);
    const hrc = hctc + (hctc * margin / 100);

    const monthlyLRC = lrc / 12;
    const monthlyHRC = hrc / 12;

    row.cells[7].innerText = lrc? formatNumber(lrc) : '';
    row.cells[8].innerText = hrc? formatNumber(hrc) : '';
    row.cells[9].innerText = (lrc || hrc) ? `${formatNumber(monthlyLRC)} — ${formatNumber(monthlyHRC)}` : '';
  });
  showMessage('Calculated values updated.');
}

function addRow(){
  const tbody = document.querySelector('#rateTable tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td contenteditable="true">Role</td>
    <td contenteditable="true">Skills</td>
    <td contenteditable="true">0</td>
    <td contenteditable="true">Location</td>
    <td contenteditable="true" class="numeric"></td>
    <td contenteditable="true" class="numeric"></td>
    <td contenteditable="true" class="numeric">0</td>
    <td class="numeric"></td>
    <td class="numeric"></td>
    <td class="numeric"></td>
  `;
  tbody.appendChild(tr);
}

function clearTable(){
  document.querySelectorAll('#rateTable tbody tr').forEach(row => {
    for(let i=0;i<row.cells.length;i++){
      if(i<4) continue; // keep role/skills/exp/location
      row.cells[i].innerText = '';
    }
  });
  showMessage('Cleared calculated columns.');
}

function showMessage(text,timeout=2500){
  const m = document.getElementById('msg'); m.textContent = text;
  clearTimeout(m._t);
  m._t = setTimeout(()=>{ m.textContent = ''; }, timeout);
}

// Copy with robust fallbacks. Will be called directly from a user click event.
async function copyTable(){
  const rows = Array.from(document.querySelectorAll('#rateTable tbody tr'));
  if(rows.length===0){ showMessage('No rows to copy.'); return; }

  // Build HTML table (only required columns) with inline styles
  const tableStyle = 'border-collapse:collapse;font-family:Arial,Helvetica,sans-serif;font-size:13px';
  const thStyle = 'background:#00338d;color:#fff;padding:8px;border:1px solid #ddd;text-align:left';
  const tdStyle = 'padding:8px;border:1px solid #ddd;text-align:left';
  let html = `<table style="${tableStyle}"><thead><tr>`;
  const headers = ['Role','Skills','Experience','Location','Monthly Rate Card (INR)'];
  headers.forEach(h => html += `<th style="${thStyle}">${h}</th>`);
  html += `</tr></thead><tbody>`;

  let plain = headers.join('\t') + '\n';

  rows.forEach(row => {
    const role = row.cells[0].innerText.trim();
    const skills = row.cells[1].innerText.trim();
    const exp = row.cells[2].innerText.trim();
    const loc = row.cells[3].innerText.trim();
    const monthly = row.cells[9].innerText.trim();
    html += `<tr>`;
    [role,skills,exp,loc,monthly].forEach(v=> html += `<td style="${tdStyle}">${v||''}</td>`);
    html += `</tr>`;
    plain += [role,skills,exp,loc,monthly].map(x=>x||'').join('\t') + '\n';
  });
  html += `</tbody></table>`;

  // First attempt: modern Clipboard API with HTML + plain text
  try{
    if(navigator.clipboard && window.ClipboardItem){
      const blobHtml = new Blob([html], {type:'text/html'});
      const blobText = new Blob([plain], {type:'text/plain'});
      const item = new ClipboardItem({'text/html': blobHtml, 'text/plain': blobText});
      await navigator.clipboard.write([item]);
      showMessage('Copied rich table to clipboard — paste into Word/Outlook.');
      return;
    }
  }catch(err){
    // may fail due to permission policy — fall through to other strategies
    console.warn('Clipboard API write failed:', err);
  }

  // Second attempt: navigator.clipboard.writeText (plain text) — still needs permission but often allowed
  try{
    if(navigator.clipboard && navigator.clipboard.writeText){
      await navigator.clipboard.writeText(plain);
      showMessage('Copied table as plain text to clipboard.');
      return;
    }
  }catch(err){
    console.warn('clipboard.writeText failed:', err);
  }

  // Third attempt: execCommand copy of an HTML node (older fallback). This must be triggered by user click.
  try{
    const container = document.createElement('div');
    container.contentEditable = true;
    container.style.position = 'fixed';
    container.style.left = '-9999px';
    container.innerHTML = html;
    document.body.appendChild(container);

    const range = document.createRange();
    range.selectNodeContents(container);
    const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);

    const ok = document.execCommand('copy');
    sel.removeAllRanges();
    container.remove();
    if(ok){
      showMessage('Copied rich table (execCommand). Paste into Word/Outlook.');
      return;
    }
  }catch(err){
    console.warn('execCommand copy failed:', err);
  }

  // Final fallback: create a textarea and copy plain text using execCommand
  try{
    const ta = document.createElement('textarea');
    ta.value = plain;
    document.body.appendChild(ta);
    ta.select();
    const ok = document.execCommand('copy');
    document.body.removeChild(ta);
    if(ok){ showMessage('Copied plain text (fallback).'); return; }
  }catch(err){ console.warn('final fallback failed', err); }

  // If all failed, give user instructions
  showMessage('Copy failed — your browser or page policy blocks clipboard access. Use Select+Ctrl+C to copy manually.');
}

// Event wiring
document.getElementById('addBtn').addEventListener('click', addRow);
document.getElementById('calcBtn').addEventListener('click', calculateRates);
document.getElementById('clearBtn').addEventListener('click', clearTable);
document.getElementById('copyBtn').addEventListener('click', copyTable);

// Live calculation whenever numeric cells change (delegated)
const tbody = document.querySelector('#rateTable tbody');
tbody.addEventListener('input', (e)=>{
  // only recalc when numeric columns change (LCTC/HCTC/Margin)
  const cell = e.target.closest('td');
  if(!cell) return;
  const idx = Array.from(cell.parentElement.children).indexOf(cell);
  if(idx>=4 && idx<=6) calculateRates();
});

</script>
</body>
</html>
